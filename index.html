<html>
<head>
<title> XSS SCANNER v1.0 </title>
<meta charset="utf-8">
<link rel="stylesheet" type="text/css" href="mystyle.css">

<script type="text/javascript">

//#################################################################################
//Funzione che controlla la presenza di form, se ne trova richiama a sua volta un altra funzione per valutare la
//presenza di costrutti attaccabili
function ValidURL(textval) {
  //For test into private net remove proxy
  urlControl = 'http://allow-any-origin.appspot.com/' + textval;
  xhr = new XMLHttpRequest();
  xhr.open("GET",urlControl,false);
  xhr.send();
  verifyURL = new DOMParser();
  var sito = xhr.responseText;
  UrlExist = xhr.status;
  if (UrlExist != 200)
    {
      return false;
    }

  riga = sito.split('\n');
  var posizione, metodo,stringa, value_post, stringa_post, pos_temp,str_temp, UrlDaControllare, tipoMetodo, nomeFunzione;
  var linkOnPage=[];
  //Trovo i campi name per inject XSS ricercando la stringa "text="
   for (var x=0; x<riga.length; x++){
          posizione=riga[x];
<<<<<<< HEAD
          stringa = posizione.indexOf('<form');
          if (stringa != -1){
            pos_temp = posizione.indexOf('method=');
              if (pos_temp != -1){
                pos_temp = posizione.substring(pos_temp+5);
                //Qui trovo il tipo di metodo;
                tipoMetodo = pos_temp.match(/"([^"]+)"/)[1];
                  //qui trovo il valore name del campo form
                  if (tipoMetodo != -1){
                    pos_temp = posizione.indexOf('name=');
                    pos_temp = posizione.substring(pos_temp+5);

                      nomeFunzione = pos_temp.match(/"([^"]+)"/)[1];
                  }
                  //Adesso devo trovare la variabile nei campi input successivi
                  for (var y = x; y < riga.length; y++){
                    var ptemp = riga[y];
                    str_temp = ptemp.indexOf('<input');
                    if (str_temp != -1){
                    console.log(str_temp);
                    str_temp = ptemp.substring(str_temp+5);
                    valoreNome = str_temp.match(/"([^"]+)"/)[1];
                    //console.log(urlControl, tipoMetodo, nomeFunzione, valoreNome);
                  }
                  }

              }
            }
          }
          //A questo punto ho ricavato tutti i parametri che mi servono per testare gli xss
          console.log(tipoMetodo);
          //if ((tipoMetodo != 'get' || (tipoMetodo != "GET") || (tipoMetodo != "Get")){
          if (tipoMetodo != 'get' ){
            alert("Metodo post non utilizzabile!");
          }
          else {
            UrlDaControllare=urlControl +'/'+ nomeFunzione ;
            TestXSS(tipoMetodo,UrlDaControllare,valoreNome);
          }
  }
=======
          stringa = posizione.indexOf('type="text"');
          if (stringa != -1){
            pos_temp = posizione.indexOf("name=");
              if (pos_temp != -1){
                pos_temp = posizione.substring(pos_temp+5);
                value_post = pos_temp.match(/"([^"]+)"/)[1];
        //Partendo dal numero di riga dove ho trovato il campo "type=text" faccio una ricerca inversa per trovare i campi del form
        //dove testare injection del payload
                  for (var y=x; y>0;y--){
                    pos_temp = riga[y];
                    str_temp = pos_temp.lastIndexOf("<form");
                      if (str_temp != -1 ){
                        str_temp =  pos_temp.substring(str_temp+5);
                        //ricavo il valore della funzione collegata al form.
                        stringa_post = str_temp.match(/"([^"]+)"/)[1];
                        UrlDaControllare=urlControl+'/'+stringa_post;
                        console.log(UrlDaControllare, value_post);
                        //Per ogni valore trovato chiamo la funzione TestXSS che proverà a inviare il payload all'URL ricavato
                        xssExist = TestXSS("GET", UrlDaControllare,value_post);

                      }
                    }
                  }
                }
              }
}
>>>>>>> 85e5901c0a4eeb7a8b8b73f39e85979f18d5098b

//#####################################################################################à
//Funzione che prende in input un metodo(GET o POST ma x adesso solo GET a causa dei limiti del proxy usato), URL e parametri
//per provare a iniettare il payload e verificare la presenza di un eventuale vulnerabilità XSS.
function TestXSS(method,url,parameters){
  var length_file, allText;
//La variabile params contiene il file da cui prendere i payload per testare l'attacco
  var params="payloads";
  var Param_reader = new FileReader();
  //Leggo il file di configurazione per caricare i payloads
  var rawFile = new XMLHttpRequest();
  rawFile.open("GET", params, false);
  rawFile.onreadystatechange = function ()
//Controllo che la connessione sia completata
  {
      if(rawFile.readyState === 4)
      {
          if(rawFile.status === 200 || rawFile.status == 0)
          {
              allText = rawFile.responseText;
              allText = allText.split('\n');
              length_file = allText.length;
        //La variabile allText è un array che contiene tutti i payloads da testare per l'attacco
          }
      }
  }

  rawFile.send(null);
   var test_xss = new XMLHttpRequest();
   var stringaGet, ResponseSite, stringaConfronto;
   //testo tutti i parametri che ho nel file
   for (var z=0; z< (length_file - 1); z++){
     //preparo la stringa da aggiungere all'URL
     stringaGet= (url + "?" + parameters + "=" + allText[z]);
     test_xss.open(method,stringaGet,false);
     test_xss.send();
     console.log("sito: " ,stringaGet);
     ResponseSite = test_xss.responseText;
     stringaConfronto = ResponseSite.indexOf(allText[z]);
  //Controllo la risposta del sito è se trovo la stessa stringa che ho iniettato significa che probabilmente ho un XSS
     if (stringaConfronto != -1){
       alert("Possibile XSS!!!!");
     }
  }
}
<<<<<<< HEAD

//Partendo dal numero di riga dove ho trovato il campo "type=text" faccio una ricerca inversa per trovare i campi del form
//dove testare injection del payload
          /*for (var y=x; y>0;y--){
            pos_temp = riga[y];
            str_temp = pos_temp.lastIndexOf("<form");
              if (str_temp != -1 ){
                str_temp =  pos_temp.substring(str_temp+5);
                //ricavo il valore della funzione collegata al form.
                stringa_post = str_temp.match(/"([^"]+)"/)[1];
                UrlDaControllare=urlControl+'/'+stringa_post;
                console.log(UrlDaControllare, value_post);
                //Per ogni valore trovato chiamo la funzione TestXSS che proverà a inviare il payload all'URL ricavato
                xssExist = TestXSS("GET", UrlDaControllare,value_post);*/
=======
>>>>>>> 85e5901c0a4eeb7a8b8b73f39e85979f18d5098b
</script>

</head>

 <body>
   <h1> XSS Scanner javascript </h1>
   <input name="urlToAnalyze" id="test2" class="inputPanel" type="text" size="20" maxlength="40" value="Inserire URL da analizzare"/>
   <button onclick="TestXSS('payloads')">Ana...lyze</button>
   <p/>

  <input type="file" name="file" id="file">
    <script type="text/javascript">
document.getElementById('file').onchange = function(){
 var file = this.files[0];

  var reader = new FileReader();
  reader.onload = function(progressEvent){
    // Entire file. Used for debug
    //console.log(this.result);
    var lines = this.result.split('\n');
    let row_number = lines.length;
    if (lines.length > 6){
        alert("Troppi URL!!!");
        return;
    }

      for(var line = 0; line < (lines.length - 1); line++){
        url_to_control = (lines[line]);
        var siteValid = ValidURL(url_to_control);
          if (siteValid == false){
            console.log("Il sito non esiste o non è verificabile!");
          }
      }


};

  reader.readAsText(file);
 }
    </script>
  </body>
</html>
